<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì∫ Smooth MJPEG Stream</title>
    <style>
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 3em;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .stream-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        #streamImg {
            border: 4px solid #00ff88;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
            transition: all 0.3s ease;
            background: #000;
            max-width: 100%;
            height: auto;
        }
        
        #streamImg.loading {
            border-color: #ffaa00;
            box-shadow: 0 0 30px rgba(255, 170, 0, 0.3);
        }
        
        #streamImg.error {
            border-color: #ff4444;
            box-shadow: 0 0 30px rgba(255, 68, 68, 0.3);
            filter: grayscale(100%);
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin: 30px 0;
        }
        
        button {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        button:hover:before {
            left: 100%;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .btn-success { 
            background: linear-gradient(135deg, #00ff88, #00cc6a);
            color: white;
        }
        
        .btn-warning { 
            background: linear-gradient(135deg, #ffaa00, #ff8800);
            color: white;
        }
        
        .btn-danger { 
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
        }
        
        .fps-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        
        .fps-control label {
            font-size: 18px;
            font-weight: 600;
        }
        
        .fps-control input[type="range"] {
            width: 300px;
            height: 8px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            -webkit-appearance: none;
        }
        
        .fps-control input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .fps-control input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00ff88;
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .fps-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 3em;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            margin-bottom: 10px;
        }
        
        .stat-label {
            font-size: 16px;
            opacity: 0.8;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-size: 18px;
            font-weight: 600;
        }
        
        .status.success {
            border-left: 4px solid #00ff88;
            color: #00ff88;
        }
        
        .status.warning {
            border-left: 4px solid #ffaa00;
            color: #ffaa00;
        }
        
        .status.error {
            border-left: 4px solid #ff4444;
            color: #ff4444;
        }
        
        .quality-control {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .quality-control h3 {
            margin-top: 0;
            color: #00ff88;
        }
        
        .quality-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .quality-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .quality-btn.active {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .quality-btn:hover {
            border-color: #00ff88;
            transform: scale(1.05);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .fps-control {
                flex-direction: column;
                gap: 15px;
            }
            
            .fps-control input[type="range"] {
                width: 250px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 200px;
            }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 255, 136, 0.6); }
            100% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
        }
        
        .glow {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>üì∫ Smooth MJPEG Stream</h1>
    
    <div class="stream-container">
        <img id="streamImg" width="640" height="480" alt="MJPEG Stream" />
        
        <div id="status" class="status">
            üöÄ Hazƒ±r - Ba≈ülatmak i√ßin butona basƒ±n
        </div>
        
        <div class="controls">
            <button class="btn-success" onclick="startStream()">‚ñ∂Ô∏è Ba≈ülat</button>
            <button class="btn-warning" onclick="pauseStream()">‚è∏Ô∏è Duraklat</button>
            <button class="btn-danger" onclick="stopStream()">‚èπÔ∏è Durdur</button>
        </div>
        
        <div class="fps-control">
            <label>üé¨ FPS Kontrol√º:</label>
            <input type="range" id="fpsSlider" min="1" max="20" value="5" oninput="updateFPS(this.value)">
            <span class="fps-value" id="fpsValue">5</span>
            <span>FPS</span>
        </div>
        
        <div class="quality-control">
            <h3>üé® Kalite Ayarlarƒ±</h3>
            <div class="quality-buttons">
                <button class="quality-btn active" onclick="setQuality('low')">D√º≈ü√ºk (320x240)</button>
                <button class="quality-btn" onclick="setQuality('medium')">Orta (640x480)</button>
                <button class="quality-btn" onclick="setQuality('high')">Y√ºksek (1280x720)</button>
            </div>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            <div class="stat-value" id="currentFPS">0</div>
            <div class="stat-label">üìä Ger√ßek FPS</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="frameCount">0</div>
            <div class="stat-label">üéûÔ∏è Frame Sayƒ±sƒ±</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="uptime">00:00</div>
            <div class="stat-label">‚è±Ô∏è √áalƒ±≈üma S√ºresi</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="errorCount">0</div>
            <div class="stat-label">‚ùå Hata Sayƒ±sƒ±</div>
        </div>
    </div>
    
    <div class="controls">
        <button class="btn-warning" onclick="goBack()">üè† Ana Sayfaya D√∂n</button>
        <button class="btn-success" onclick="fullscreen()">üñ•Ô∏è Tam Ekran</button>
    </div>
</div>

<script>
    const SERVER_URL = window.location.origin;
    
    let streamInterval = null;
    let isRunning = false;
    let frameCount = 0;
    let targetFPS = 5;
    let fpsCounter = 0;
    let fpsStartTime = Date.now();
    let startTime = null;
    let uptimeInterval = null;
    let errorCount = 0;
    let currentQuality = 'low';
    
    const img = document.getElementById('streamImg');
    const status = document.getElementById('status');
    const currentFPSSpan = document.getElementById('currentFPS');
    const frameCountSpan = document.getElementById('frameCount');
    const uptimeSpan = document.getElementById('uptime');
    const errorCountSpan = document.getElementById('errorCount');
    const fpsValue = document.getElementById('fpsValue');
    
    const qualitySettings = {
        low: { width: 320, height: 240, quality: 8 },
        medium: { width: 640, height: 480, quality: 5 },
        high: { width: 1280, height: 720, quality: 3 }
    };
    
    function updateFrame() {
        if (!isRunning) return;
        
        const timestamp = new Date().getTime();
        const quality = qualitySettings[currentQuality];
        
        img.className = 'loading';
        
        // Yeni g√∂r√ºnt√º olu≈ütur
        const newImg = new Image();
        newImg.crossOrigin = 'anonymous';
        
        newImg.onload = function() {
            img.src = newImg.src;
            img.className = '';
            frameCount++;
            frameCountSpan.textContent = frameCount;
            
            // FPS hesapla
            fpsCounter++;
            const elapsed = (Date.now() - fpsStartTime) / 1000;
            if (elapsed >= 1) {
                const realFPS = Math.round(fpsCounter / elapsed);
                currentFPSSpan.textContent = realFPS;
                fpsCounter = 0;
                fpsStartTime = Date.now();
                
                // Ger√ßek FPS √ßok d√º≈ü√ºkse uyarƒ±
                if (realFPS < targetFPS * 0.5) {
                    status.className = 'status warning';
                    status.textContent = '‚ö†Ô∏è Yava≈ü baƒülantƒ± - FPS d√º≈ü√ºrmeyi deneyin';
                } else {
                    status.className = 'status success';
                    status.textContent = '‚úÖ Stream aktif';
                }
            }
        };
        
        newImg.onerror = function() {
            img.className = 'error';
            errorCount++;
            errorCountSpan.textContent = errorCount;
            status.className = 'status error';
            status.textContent = '‚ùå Frame y√ºkleme hatasƒ±';
            console.error('Frame y√ºkleme hatasƒ±');
        };
        
        // Frame URL'i olu≈ütur
        const params = new URLSearchParams({
            t: timestamp,
            w: quality.width,
            h: quality.height,
            q: quality.quality
        });
        
        newImg.src = `${SERVER_URL}/single-frame?${params}`;
    }
    
    function startStream() {
        if (isRunning) return;
        
        isRunning = true;
        frameCount = 0;
        fpsCounter = 0;
        fpsStartTime = Date.now();
        startTime = Date.now();
        
        status.className = 'status success';
        status.textContent = '‚úÖ Stream ba≈ülatƒ±lƒ±yor...';
        
        img.classList.add('glow');
        
        // Uptime sayacƒ±nƒ± ba≈ülat
        uptimeInterval = setInterval(() => {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            uptimeSpan.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
        
        updateFrame();
        streamInterval = setInterval(updateFrame, Math.round(1000 / targetFPS));
    }
    
    function pauseStream() {
        if (!isRunning) {
            startStream();
            return;
        }
        
        isRunning = false;
        clearInterval(streamInterval);
        clearInterval(uptimeInterval);
        
        status.className = 'status warning';
        status.textContent = '‚è∏Ô∏è Stream duraklatƒ±ldƒ±';
        
        img.classList.remove('glow');
    }
    
    function stopStream() {
        isRunning = false;
        clearInterval(streamInterval);
        clearInterval(uptimeInterval);
        
        frameCount = 0;
        errorCount = 0;
        
        status.className = 'status';
        status.textContent = '‚èπÔ∏è Stream durduruldu';
        
        img.classList.remove('glow');
        img.className = '';
        img.src = '';
        
        // T√ºm saya√ßlarƒ± sƒ±fƒ±rla
        currentFPSSpan.textContent = '0';
        frameCountSpan.textContent = '0';
        uptimeSpan.textContent = '00:00';
        errorCountSpan.textContent = '0';
    }
    
    function updateFPS(value) {
        targetFPS = parseInt(value);
        fpsValue.textContent = targetFPS;
        
        if (isRunning) {
            clearInterval(streamInterval);
            streamInterval = setInterval(updateFrame, Math.round(1000 / targetFPS));
        }
    }
    
    function setQuality(quality) {
        currentQuality = quality;
        
        // Kalite butonlarƒ±nƒ± g√ºncelle
        document.querySelectorAll('.quality-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // G√∂r√ºnt√º boyutunu g√ºncelle
        const settings = qualitySettings[quality];
        img.width = settings.width;
        img.height = settings.height;
        
        status.className = 'status warning';
        status.textContent = `üé® Kalite deƒüi≈ütirildi: ${quality.toUpperCase()}`;
        
        console.log(`Kalite ayarlandƒ±: ${quality}`, settings);
    }
    
    function goBack() {
        window.location.href = '/';
    }
    
    function fullscreen() {
        if (img.requestFullscreen) {
            img.requestFullscreen();
        } else if (img.webkitRequestFullscreen) {
            img.webkitRequestFullscreen();
        } else if (img.msRequestFullscreen) {
            img.msRequestFullscreen();
        }
    }
    
    // Klavye kƒ±sayollarƒ±
    document.addEventListener('keydown', function(e) {
        switch(e.code) {
            case 'Space':
                e.preventDefault();
                if (isRunning) {
                    pauseStream();
                } else {
                    startStream();
                }
                break;
            case 'KeyS':
                stopStream();
                break;
            case 'KeyF':
                fullscreen();
                break;
            case 'Escape':
                goBack();
                break;
            case 'ArrowUp':
                e.preventDefault();
                const currentFPS = parseInt(document.getElementById('fpsSlider').value);
                if (currentFPS < 20) {
                    document.getElementById('fpsSlider').value = currentFPS + 1;
                    updateFPS(currentFPS + 1);
                }
                break;
            case 'ArrowDown':
                e.preventDefault();
                const currentFPS2 = parseInt(document.getElementById('fpsSlider').value);
                if (currentFPS2 > 1) {
                    document.getElementById('fpsSlider').value = currentFPS2 - 1;
                    updateFPS(currentFPS2 - 1);
                }
                break;
        }
    });
    
    // Sayfa y√ºklendiƒüinde otomatik ba≈ülat
    window.onload = function() {
        console.log('Smooth Stream sayfasƒ± y√ºklendi');
        setTimeout(startStream, 1000);
    };
    
    // Sayfa kapatƒ±lƒ±rken temizlik
    window.onbeforeunload = function() {
        stopStream();
    };
    
    // Sayfa g√∂r√ºn√ºrl√ºk deƒüi≈üiminde stream'i duraklat/devam ettir
    document.addEventListener('visibilitychange', function() {
        if (document.hidden && isRunning) {
            pauseStream();
        }
    });
</script>
</body>
</html>